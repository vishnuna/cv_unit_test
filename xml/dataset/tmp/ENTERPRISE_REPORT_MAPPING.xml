<data_set_category name="ENTERPRISE_REPORT_MAPPING"
                   description="Enterprise Report Mapping"
                   windowTitle="Enterprise Report Mapping Setup"
                   entityName="EnterpriseReportMapping"
                   screenWidth="950"
                   screenHeight="500"
                   objectType="EnterpriseReportMapping"
                   singleDataSet="EnterpriseReportMapping"
                   extends="SUBMISSION_UTILS, COMMON_UTILS">

    <events>
        <event name="calendarUpdate">
            <filter property="eventType" value="AXIOM_OBJECT_UPDATE_EVENT"/>
            <filter property="objectType" value="EnterpriseReportCalendar"/>
        </event>
    </events>

    <parameters>
        <parameter name="currentTable" description="Current Table" type="string" hidden="true"/>
        <parameter name="enabledReportingSystems" description="Enabled Reporting Systems" type="integer" hidden="true"/>

        <parameter name="fsaReports" description="FSA Reports" type="tree" group="FSA Reports"
                   rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "FSA")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "FSA", "fsaReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="FSA Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="FSA Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="FSA"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Common Mapping Node" arbitraryNameAllowed="false" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>

            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("FSAFirm", null);
			    </nodeNameLookup>
                <parameter name="firmName" description="Firm" type="String" isDataSet="FSAFirm">
                    <default>
                        currentNode.getName()
                    </default>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "FSAFirm name");
                        macro("checkGlobalObjectExists", "FSAFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "FSAFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"FSA"'/>
                <macro name="consolidationLevelValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="boeReports" description="BoE Reports" type="tree" group="BoE Reports" rootNodeType="rootReportNode">

            <if>macro("isReportingSystemDisabled", "BOE")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "BOE", "boeReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="BoE Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>

            <nodeType name="EnterpriseReportMapping:report" description="BoE Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="BOE"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>

            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("BOEFirm", null);
			    </nodeNameLookup>
                <parameter name="firmName" description="Firm" type="String" isDataSet="BOEFirm">
                    <default>
                        currentNode.getName();
                    </default>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "BOEFirm name");
                        macro("checkGlobalObjectExists", "BOEFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "BOEFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"BOE"'/>
                <macro name="entityValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="ffiecReports" description="FFIEC Reports" type="tree" group="FFIEC Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "FFIEC")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "FFIEC", "ffiecReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="FFIEC Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="FFIEC Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="FFIEC"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>

            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("FFIECFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="FFIECFirm">
                    <default>
                        currentNode.getName();
                    </default>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "FFIECFirm name");
                        macro("checkGlobalObjectExists", "FFIECFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "FFIECFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="validationRuleParameter"/>
                <macro name="workflowParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"FFIEC"'/>

                <macro name="entityValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

                <parameter name="boe_oscaReports" description="BoE OSCA Reports" type="tree" group="BoE OSCA Reports" rootNodeType="rootReportNode">

            <if>macro("isReportingSystemDisabled", "BOE_OSCA")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "BOE_OSCA", "boe_oscaReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="BoE OSCA Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>

            <nodeType name="EnterpriseReportMapping:report" description="BoE OSCA Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="BOE_OSCA"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>

            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("BOE_OSCAFirm", null);
			    </nodeNameLookup>
                <parameter name="firmName" description="Firm" type="String" isDataSet="BOE_OSCAFirm">
                    <default>
                        currentNode.getName();
                    </default>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "BOE_OSCAFirm name");
                        macro("checkGlobalObjectExists", "BOE_OSCAFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "BOE_OSCAFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"BOE_OSCA"'/>
                <macro name="entityValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="masReports" description="MAS Reports" type="tree" group="MAS Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "MAS")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "MAS", "masReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="MAS Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="MAS Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="MAS"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>

            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("MASFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="MASFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("MASFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "MASFirm name");
                        macro("checkGlobalObjectExists", "MASFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "MASFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"MAS"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="rbiReports" description="RBI Reports" type="tree" group="RBI Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "RBI")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "RBI", "rbiReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="RBI Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="RBI Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="RBI"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("RBIFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="RBIFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("RBIFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "RBIFirm name");
                        macro("checkGlobalObjectExists", "RBIFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "RBIFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"RBI"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="hkmaReports" description="HKMA Reports" type="tree" group="HKMA Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "HKMA")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "HKMA", "hkmaReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="HKMA Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="HKMA Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="HKMA"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("HKMAFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="HKMAFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("HKMAFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "HKMAFirm name");
                        macro("checkGlobalObjectExists", "HKMAFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "HKMAFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"HKMA"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="bokReports" description="BOK Reports" type="tree" group="BOK Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "BOK")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "BOK", "bokReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="BOK Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="BOK Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="BOK"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("BOKFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="BOKFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("BOKFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "BOKFirm name");
                        macro("checkGlobalObjectExists", "BOKFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "BOKFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"BOK"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="fssReports" description="FSS Reports" type="tree" group="FSS Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "FSS")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "FSS", "fssReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="FSS Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="FSS Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="FSS"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("FSSFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="FSSFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("FSSFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "FSSFirm name");
                        macro("checkGlobalObjectExists", "FSSFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "FSSFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"FSS"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="kfbReports" description="KFB Reports" type="tree" group="KFB Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "KFB")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "KFB", "kfbReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="KFB Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="KFB Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="KFB"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("KFBFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="KFBFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("KFBFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "KFBFirm name");
                        macro("checkGlobalObjectExists", "KFBFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "KFBFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"KFBFirm"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="internalReports" description="Internal Reports" type="tree" group="Internal Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "Internal")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "Internal", "internalReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="Internal Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="Internal Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="Internal"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("InternalFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="InternalFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("InternalFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "InternalFirm name");
                        macro("checkGlobalObjectExists", "InternalFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "InternalFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"InternalFirm"'/>
                <macro name="entityValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="apraReports" description="APRA Reports" type="tree" group="APRA Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "APRA")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "APRA", "apraReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="APRA Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="APRA Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="APRA"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("APRAFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="APRAFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("APRAFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "APRAFirm name");
                        macro("checkGlobalObjectExists", "APRAFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "APRAFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"APRA"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="bnmReports" description="BNM Reports" type="tree" group="BNM Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "BNM")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "BNM", "bnmReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="BNM Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="BNM Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="BNM"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("BNMFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="BNMFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("BNMFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "BNMFirm name");
                        macro("checkGlobalObjectExists", "BNMFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "BNMFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"BNM"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="hksfcReports" description="HKSFC Reports" type="tree" group="HKSFC Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "HKSFC")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "HKSFC", "hksfcReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="HKSFC Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="HKSFC Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="HKSFC"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("HKSFCFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="HKSFCFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("HKSFCFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "HKSFCFirm name");
                        macro("checkGlobalObjectExists", "HKSFCFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "HKSFCFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"HKSFC"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="pbocReports" description="PBOC Reports" type="tree" group="PBOC Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "PBOC")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "PBOC", "pbocReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="PBOC Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="PBOC Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="PBOC"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("PBOCFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="PBOCFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("PBOCFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "PBOCFirm name");
                        macro("checkGlobalObjectExists", "PBOCFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "PBOCFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"PBOC"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="safeReports" description="SAFE Reports" type="tree" group="SAFE Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "SAFE")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "SAFE", "safeReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="SAFE Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="SAFE Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="SAFE"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("SAFEFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="SAFEFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("SAFEFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "SAFEFirm name");
                        macro("checkGlobalObjectExists", "SAFEFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "SAFEFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"SAFE"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="cbrcReports" description="CBRC Reports" type="tree" group="CBRC Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "CBRC")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "CBRC", "cbrcReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="CBRC Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="CBRC Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="CBRC"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("CBRCFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="CBRCFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("CBRCFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "CBRCFirm name");
                        macro("checkGlobalObjectExists", "CBRCFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "CBRCFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"CBRC"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="satReports" description="SAT Reports" type="tree" group="SAT Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "SAT")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "SAT", "satReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="SAT Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="SAT Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="SAT"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("SATFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="SATFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("SATFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "SATFirm name");
                        macro("checkGlobalObjectExists", "SATFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "SATFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"SAT"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="sebiReports" description="SEBI Reports" type="tree" group="SEBI Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "SEBI")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "SEBI", "sebiReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="SEBI Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="SEBI Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="SEBI"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("SEBIFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="SEBIFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("SEBIFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "SEBIFirm name");
                        macro("checkGlobalObjectExists", "SEBIFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "SEBIFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"SEBI"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>


        <parameter name="genericReports" description="Reports" type="tree" group="Generic Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "Generic")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "Generic", "genericReports");
                        </then>
                    </if>
                </else>
            </if>
            <nodeType name="rootReportNode" description="Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="Generic"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("GenericFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="GenericFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("GenericFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "GenericFirm name");
                        macro("checkGlobalObjectExists", "GenericFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "GenericFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"Generic"'/>
                <macro name="consolidationLevelValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>
            <renameGroup>
                if(getSystemDefault("genericReportingSystemName")==null,"Generic Reports",if(getSystemDefault("genericReportingSystemName").trim().equals(""),"Generic Reports",(getSystemDefault("genericReportingSystemName")+" Reports").trim()));
            </renameGroup>
        </parameter>

        <parameter name="generic2Reports" description="Reports" type="tree" group="Generic2 Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "Generic2")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "Generic2", "generic2Reports");
                        </then>
                    </if>
                </else>
            </if>
            <nodeType name="rootReportNode" description="Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="Generic2"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("Generic2Firm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="Generic2Firm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("Generic2Firm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "Generic2Firm name");
                        macro("checkGlobalObjectExists", "Generic2Firm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "Generic2Firm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"Generic2"'/>
                <macro name="consolidationLevelValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>
            <renameGroup>
                if(getSystemDefault("genericReportingSystemName2")==null,"Generic2 Reports",if(getSystemDefault("genericReportingSystemName2").trim().equals(""),"Generic2 Reports",(getSystemDefault("genericReportingSystemName2")+" Reports").trim()));
            </renameGroup>
        </parameter>

        <parameter name="generic3Reports" description="Reports" type="tree" group="Generic3 Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "Generic3")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "Generic3", "generic3Reports");
                        </then>
                    </if>
                </else>
            </if>
            <nodeType name="rootReportNode" description="Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="Generic3"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("Generic3Firm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="Generic3Firm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("Generic3Firm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "Generic3Firm name");
                        macro("checkGlobalObjectExists", "Generic3Firm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "Generic3Firm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"Generic3"'/>
                <macro name="consolidationLevelValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>
            <renameGroup>
                if(getSystemDefault("genericReportingSystemName3")==null,"Generic3 Reports",if(getSystemDefault("genericReportingSystemName3").trim().equals(""),"Generic3 Reports",(getSystemDefault("genericReportingSystemName3")+" Reports").trim()));
            </renameGroup>
        </parameter>

        <parameter name="pfrdReports" description="PFRD Reports" type="tree" group="PFRD Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "PFRD")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "PFRD", "pfrdReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="PFRD Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="PFRD Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="PFRD"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("PFRDFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="PFRDFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("PFRDFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "PFRDFirm name");
                        macro("checkGlobalObjectExists", "PFRDFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "PFRDFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"PFRD"'/>
                <macro name="entityValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>
        
        <parameter name="secReports" description="SEC Reports" type="tree" group="SEC Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "SEC")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "SEC", "secReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="SEC Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="SEC Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="SEC"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("SECFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="SECFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("SECFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "SECFirm name");
                        macro("checkGlobalObjectExists", "SECFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "SECFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"SEC"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="frbReports" description="FRB Reports" type="tree" group="FRB Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "FRB")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "FRB", "frbReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="FRB Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="FRB Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="FRB"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("FRBFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="FRBFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("FRBFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "FRBFirm name");
                        macro("checkGlobalObjectExists", "FRBFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "FRBFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"FRB"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="finraReports" description="FINRA Reports" type="tree" group="FINRA Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "FINRA")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "FINRA", "finraReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="FINRA Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="FINRA Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="FINRA"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                    childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("FINRAFirm", null);
			    </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="FINRAFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("FINRAFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "FINRAFirm name");
                        macro("checkGlobalObjectExists", "FINRAFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "FINRAFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"FINRA"'/>
                <macro name="entityValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="finmaReports" description="FINMA Reports" type="tree" group="FINMA Reports"
                   rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "FINMA")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "FINMA", "finmaReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="FINMA Reports" renameAllowed="false" deleteAllowed="false"
                      hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="FINMA Report" renameAllowed="false"
                      deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true"
                           defaultValue="FINMA"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false"
                      hasChildren="true" childrenAreFixed="false"
                      childrenTypes="effectiveDateNode" pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true"
                      hasChildren="true" childrenAreFixed="false"
                      childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("FINMAFirm", null);
                </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="FINMAFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("FINMAFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "FINMAFirm name");
                        macro("checkGlobalObjectExists", "FINMAFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "FINMAFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"FINMA"'/>
                <macro name="entityValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

        <parameter name="fcaReports" description="FCA Reports" type="tree" group="FCA Reports" rootNodeType="rootReportNode">
            <if>macro("isReportingSystemDisabled", "FCA")
                <then>
                    <removed/>
                </then>
                <else>
                    <enabled/>
                    <if>event("calendarUpdate") != null
                        <then>
                            macro("updateReports", "FCA", "fcaReports");
                        </then>
                    </if>
                </else>
            </if>

            <nodeType name="rootReportNode" description="FCA Reports" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="true"
                      childrenTypes="EnterpriseReportMapping:report"/>
            <nodeType name="EnterpriseReportMapping:report" description="FCA Report" renameAllowed="false" deleteAllowed="false" hasChildren="true"
                      childrenAreFixed="false" childrenTypes="commonMappingNode, mappingNode" userCanAdd="mappingNode">
                <parameter name="calendarReportId" type="string" description="Calendar Report Id" hidden="true"/>
                <parameter name="reportingSystem" type="string" description="Reporting System" hidden="true" defaultValue="FCA"/>
            </nodeType>

            <nodeType name="commonMappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="false" hasChildren="true" childrenAreFixed="false"
                      childrenTypes="effectiveDateNode"  pasteAsAllowed="false">
            </nodeType>
            <nodeType name="mappingNode" description="Mapping Node" renameAllowed="false" deleteAllowed="true" hasChildren="true" childrenAreFixed="false"
                      childrenTypes="effectiveDateNode" pasteAsAllowed="false">
                <nodeNameLookup>
                    editor.getRemoteProxy().lookupObjects("FCAFirm", null);
                </nodeNameLookup>

                <parameter name="firmName" description="Firm" type="String" isDataSet="FCAFirm">
                    <default>
                        currentNode.getName();
                    </default>

                    <attribute name="lookupFromValues">"Firm Name"
                        <comma/>
                        editor.getRemoteProxy().lookupObjects("FCAFirm");
                    </attribute>
                    <onParameterChange>
                        <if>newValue != null and newValue.length() &gt; 0
                            <then>
                                currentNode.setName(newValue.toString());
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("checkNonEmpty", currentParameter.getParameterValue(), "FCAFirm name");
                        macro("checkGlobalObjectExists", "FCAFirm", currentParameter.getParameterValue(), false);
                    </verifyForSave>

                    <validation>
                        macro("checkNodeIsUnique", newValue, true);
                        macro("checkGlobalObjectExists", "FCAFirm", newValue, true);
                    </validation>
                </parameter>
                <nodeNameValidation>
                    return null;
                </nodeNameValidation>
            </nodeType>
            <nodeType name="effectiveDateNode" description="Effective Date" renameAllowed="false" deleteAllowed="true"
                      hasChildren="false" autoSort="true" sortByComparable="true" reorderingAllowed="false" alphaNumericName="false">
                <macro name="effectiveDateParameter"/>
                <macro name="mappingDisabledParameter"/>
                <macro name="branchParameter"/>
                <macro name="reportParameter"/>
                <macro name="specificKeyMappingsParameter" arguments='"FCA"'/>
                <macro name="consolidationLevelValueMappingsParameter"/>
                <macro name="materialCurrencyValueMappingsParameter"/>
            </nodeType>

            <onNodeAdded>
                <macro name="onNodeAdded"/>
            </onNodeAdded>

        </parameter>

    </parameters>

    <loadCode>
        var enabledReportingSystems = function("axiomsl.util.ReportingSystems", "getEnabledReportingSystems", editor.getAxiomObjectManager(), editor.getAxiomEnvironment());
        param("enabledReportingSystems") = enabledReportingSystems;

        <if> !function("axiomsl.util.ReportingSystems", "isAnyReportingSystemEnabled", enabledReportingSystems)
            <then>
                message("No reporting system selected. Reporting systems can be selected from System Defaults");
            </then>
        </if>

        var mapping =<originalAxiom/>;

        var calendar = editor.locateObjectById("EnterpriseReportCalendar", "EnterpriseReportCalendar");
        var reports = calendar.getTable("reports");

        <!-- populate report nodes from Enterprise Report Calendar -->
        <for>var i = 0 <comma/> i &lt; reports.size() <comma/> i++
            <do>
                var node = reports.get(i);
                var reportingSystem = node.getProperty("reportingSystem");
                var newLine = param(reportingSystem.toLowerCase() + "Reports").createChild("EnterpriseReportMapping:report", node.getProperty("name"));
                newLine.param("calendarReportId") = node.getProperty("id");
                newLine.param("reportingSystem") = reportingSystem;
                newLine.addToParent();

                var commonMappingNode = newLine.createChild("commonMappingNode", "Common Mapping");
                commonMappingNode.addToParent();
            </do>
        </for>

        <!-- for empty case -->
        var paramList = function("axiomsl.util.ReportingSystems", "getReportNameFullList");
        <for>var i = 0 <comma/> i &lt; paramList.size() <comma/> i++
            <do>
                param(paramList.get(i));
            </do>
        </for>
        param("currentTable") = "";

        macro("setGenerics","");
        macro("setGenerics","2");
        macro("setGenerics","3");
        <!-- populate mapping tree nodes -->
        var mappings = mapping.getTable("mappings");
        <for>var k = 0 <comma/> k &lt; mappings.size() <comma/> k++
            <do>
                var mappingRow = mappings.get(k);
                var calendarReport = mappingRow.getProperty("reportNode").getTargetObject();
                var reportName = calendarReport.getProperty("name");
                var reportingSystem = calendarReport.getProperty("reportingSystem");
                var reportNodes = param(reportingSystem.toLowerCase() + "Reports");

                <for>var i = 0 <comma/> i &lt; reportNodes.childCount() <comma/> i++
                    <do>
                        var node = reportNodes.child(i);
                        <if>node.getName().equals(reportName)
                            <then>
                                var commonMappings = mappingRow.getTable("commonMappings");
                                var commonMappingNode;
                                <if>node.childCount() == 0
                                    <then>
                                        commonMappingNode = node.createChild("commonMappingNode", "Common Mapping");
                                        commonMappingNode.addToParent();
                                    </then>
                                    <else>
                                        commonMappingNode = node.child(0);
                                    </else>
                                </if>

                                <for>var j = 0 <comma/> j &lt; commonMappings.size() <comma/> j++
                                    <do>
                                        var commonMapping = commonMappings.get(j);
                                        macro("loadMapping", commonMappingNode, commonMapping, reportingSystem);
                                    </do>
                                </for>

                                var firms = mappingRow.getTable("firmMappings");
                                <for>var j = 0 <comma/> j &lt; firms.size() <comma/> j++
                                    <do>
                                        var firmName = firms.get(j).getReference("firm").getTargetObject().getProperty("name");
                                        var firmNode = node.createChild("mappingNode", firmName);
                                        firmNode.param("firmName") = firmName;
                                        var firmMappings = firms.get(j).getTable("mappings");
                                        <for>var m = 0 <comma/> m &lt; firmMappings.size() <comma/> m++
                                            <do>
                                                var firmMapping = firmMappings.get(m);
                                                macro("loadMapping", firmNode, firmMapping, reportingSystem);
                                            </do>
                                        </for>
                                        firmNode.addToParent();
                                    </do>
                                </for>
                            </then>
                        </if>
                    </do>
                </for>                                                         
            </do>
        </for>
    </loadCode>

    <saveCode>
        var mapping =<axiomForSave/>;
        var oldMapping =editor.locateObjectById("EnterpriseReportMapping", "EnterpriseReportMapping");;
        var routeToMapping = function("axiomsl.server.object_framework.RouteToObject", "createDirectRoute", mapping);

        var calendar = editor.locateObjectById("EnterpriseReportCalendar", "EnterpriseReportCalendar");
        var calendarReports = calendar.getTable("reports");
        var routeToCalendar = function("axiomsl.server.object_framework.RouteToObject", "createDirectRoute", calendar);

        var resolver = editor.getAxiomObjectManager().getResolver();

        var reportTypes = function("axiomsl.util.ReportingSystems", "getEnabledReportingSystemNameList", param("enabledReportingSystems"));

        <for>var t = 0  <comma/> t &lt; reportTypes.size() <comma/> t++
            <do>
                var firmType = reportTypes.get(t) + "Firm";
                var reportingSystem = reportTypes.get(t);

                var reports = param(reportTypes.get(t).toLowerCase() + "Reports");
                <for>var i = 0
                    <comma/>
                    i &lt; reports.childCount()
                    <comma/>
                    i++
                    <do>
                        var reportNode = reports.child(i);
                        var report = mapping.getTable("mappings").addRow("EnterpriseReportMapping:report");
                        var calendarReportRef = report.createReferencePropertyValue(routeToCalendar, array(calendar, "reports", calendarReports.locate(reportNode.getName())));
                        report.setProperty("reportNode", calendarReportRef);
                        report.setProperty("name", reportNode.getName());
                        report.setProperty("id", function("axiomsl.util.UUID", "randomUUID").toString());
                        var reportObjects = report.getTable("reportObjects");

                        <for>var j = 0 <comma/> j &lt; reportNode.childCount() <comma/> j++
                            <do>
                                var mappingNode = reportNode.child(j);
                                var mappingTable;
                                <if>mappingNode.type() == "commonMappingNode"
                                    <then>
                                        mappingTable = report.getTable("commonMappings");
                                    </then>
                                    <else>
                                        var firmMappings = report.getTable("firmMappings");
                                        var firm = firmMappings.addRow("EnterpriseReportMapping:mappingFirmSpecifc");
                                        var firmID = function("axiomsl.server.object_framework.ObjectID", "createNameId", firmType, null, mappingNode.param("firmName"));
                                        var firmObject = editor.getRemoteProxy().getAxiomObjectManager().locate(firmID);
                                        firm.setProperty("firm", firm.createReferencePropertyValue(function("axiomsl.server.object_framework.RouteToObject", "createEmptyRoute"), firmObject));

                                        mappingTable = firm.getTable("mappings");
                                    </else>
                                </if>

                                <for>var k = 0 <comma/> k &lt; mappingNode.childCount() <comma/> k++
                                    <do>
                                        var effectiveDateNode = mappingNode.child(k);
                                        var mappingObject = mapping.createObjectPropertyValue("EnterpriseReportMapping:mapping");
                                        macro("saveMapping", effectiveDateNode, mappingObject, reportingSystem);
                                        mappingTable.addRowToSortedTable(mappingObject);
                                    </do>
                                </for>
                            </do>
                        </for>
                    </do>
                </for>
            </do>
        </for>

    </saveCode>

    <macros>
        <macro name="effectiveDateParameter">
            <parameter name="effectiveDate" description="Effective Date" type="Date">
                <onParameterChange>
                    currentNode.setComparable(newValue);
                    currentNode.setName(function("axiomsl.util.basic.ObjectFormatter", "toGUIString", "dd-MMM-yyyy", newValue));
                </onParameterChange>
                <verifyForSave>
                    macro("checkNodeIsUnique", currentNode.getName(), false);
                </verifyForSave>
            </parameter>
        </macro>

        <macro name="clearReportParameter">
            <if>param("branch") == null or param("branch") == "" or param("project") == null
                    or param("project") == ""
                <then>
                    macro("clearParameter", "report");
                </then>
                <else>
                    var brId = editor.createNameId("Branch", param("project") + "!" + param("branch"));
                    var resolver = editor.getAxiomObjectManager().getResolver();
                    var brDbId = resolver.resolve(brId).getDbId();
                    var reportId = function("axiomsl.server.object_framework.ObjectID", "createNameId", param("reportType"), brDbId, param("report"));
                    <if>!axiomObjectManager.objectExists(reportId, editor.getAxiomEnvironment())
                        <then>
                            macro("clearParameter", "report");
                        </then>
                    </if>
                </else>
            </if>
        </macro>

        <macro name="branchParameter">
            <parameter name="project" description="Project" type="string" defaultValue="" isDataSet="Project">
                <if>param("mappingDisabled")
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <enabled/>
                    </else>
                </if>
                <verifyForSave>
                    <if>!param("mappingDisabled")
                        <then>
                            macro("verifyNonEmpty");
                        </then>
                    </if>
                </verifyForSave>
                <onParameterChange>
                    var branchId = editor.createNameId("Branch", param("project") + "!" + param("branch"));
                    <if> !axiomObjectManager.objectExists(branchId, editor.getAxiomEnvironment())
                        <then>
                            macro("clearParameter", "report");
                            macro("clearParameter", "branch");
                        </then>
                        <else>
                            macro("clearReportParameter");
                        </else>
                    </if>
                </onParameterChange>
            </parameter>
            
            <parameter name="branch" description="Branch" type="string" isDataSet="Branch">
                 <attribute name="projectName">
                    <!--for lookup-->
                    param("project")
                </attribute>
                
                <if>macro("isEmptyOrInvalid", param("project"))
                    <then>
                        <readonly/>
                    </then>
                    <else>
                        <enabled/>
                    </else>
                </if>

                <verifyForSave>
                    <if>!param("mappingDisabled")
                        <then>
                            macro("verifyNonEmpty");
                        </then>
                    </if>
                </verifyForSave>
                
                <onParameterChange>
                    macro("clearReportParameter");


                    <!-- TODO: clear wf and vr parameters -->
                    <!--macro("clearParameter", "validationRule");-->
                    <!--macro("clearParameter", "workflow");-->
                </onParameterChange>
            </parameter>

        </macro>

        <macro name="clearParameter" arguments="parameterName">
            <if>param(<parameterName/>)!= null
                <then>
                    param(<parameterName/>)="";
                </then>
            </if>
        </macro>

        <macro name="reportParameter">
            <parameter name="reportType" description="Report Type" type="string">
                <onParameterChange>
                    macro("clearParameter", "report");
                </onParameterChange>

                <if>macro("isEmpty", param("branch"))
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <if>param("mappingDisabled")
                            <then>
                                <disabled/>
                            </then>
                            <else>
                                <enabled/>
                                <if>macro("getReportingSystem") == "FCA" or macro("getReportingSystem") == "Generic" or macro("getReportingSystem") == "Generic2" or macro("getReportingSystem") == "Generic3"
                                    <then>
                                        choices(asDescription(list(ndo("FreeFormReport",l("FreeFormReport")), ndo("TabularReport", l("TabularReport")), ndo("MappedReportingModule", l("MappedReportingModule")))));
                                    </then>
                                    <else>
                                        choices(asDescription(list(ndo("FreeFormReport",l("FreeFormReport")), ndo("TabularReport", l("TabularReport")))));
                                    </else>
                                </if>
                            </else>
                        </if>
                    </else>
                </if>
            </parameter>

            <parameter name="report" description="Report" type="string">
                <attribute name="lookupFromValues">param("reportType")
                    <comma/>
                    macro("getPossibleReportObjects");
                </attribute>
                <convertInputValue>
                    inputValue.getName();
                </convertInputValue>
                <if>macro("isEmpty", param("branch"))
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <if>param("mappingDisabled")
                            <then>
                                <disabled/>
                            </then>
                            <else>
                                <enabled/>
                            </else>
                        </if>
                    </else>
                </if>
                <validation>
                    <if>newValue!=null and newValue!=""
                        <then>
                            macro("checkObjectIsValid", param("reportType"), newValue, true);
                        </then>
                    </if>
                </validation>
                <onParameterChange>
                    <if>newValue != null and newValue.length() > 0 and oldValue != newValue
                        <then>
                            var found = false;
                            var foundNode = null;
                            macro("findReportObjectInCurrentNode", found, foundNode, newValue);
                            <if>found
                                <then>
                                    macro("updateCurrentReportObjectWithLock", foundNode);
                                </then>
                                <else>
                                    var calendarReportNode = macro("getCalendarReportNode");
                                    var specificTypes = list();
                                    <case>
                                        calendarReportNode.param("reportingSystem").equals("FSA")
                                        or calendarReportNode.param("reportingSystem").equals("FCA")
                                        or calendarReportNode.param("reportingSystem").equals("Generic")
                                        or calendarReportNode.param("reportingSystem").equals("Generic2")
                                        or calendarReportNode.param("reportingSystem").equals("Generic3")
                                        <then>
                                            specificTypes.add("ENTITY+CONSOLIDATION_LEVEL");
                                            specificTypes.add("MATERIAL_CURRENCY");
                                        </then>
                                        calendarReportNode.param("reportingSystem").equals("MAS") or calendarReportNode.param("reportingSystem").equals("RBI")
                                        or calendarReportNode.param("reportingSystem").equals("HKMA") or calendarReportNode.param("reportingSystem").equals("BOK")
                                        or calendarReportNode.param("reportingSystem").equals("FSS") or calendarReportNode.param("reportingSystem").equals("KFB")
                                        or calendarReportNode.param("reportingSystem").equals("APRA") or calendarReportNode.param("reportingSystem").equals("BNM")
                                        or calendarReportNode.param("reportingSystem").equals("HKSFC") or calendarReportNode.param("reportingSystem").equals("PBOC")
                                        or calendarReportNode.param("reportingSystem").equals("SAFE") or calendarReportNode.param("reportingSystem").equals("CBRC")
                                        or calendarReportNode.param("reportingSystem").equals("SEBI") or calendarReportNode.param("reportingSystem").equals("SEC")
                                        or calendarReportNode.param("reportingSystem").equals("SAT") or calendarReportNode.param("reportingSystem").equals("FRB")
                                        or calendarReportNode.param("reportingSystem").equals("FINRA")
                                        <then>
                                            specificTypes.add("ENTITY");
                                            specificTypes.add("MATERIAL_CURRENCY");
                                        </then>
                                        calendarReportNode.param("reportingSystem").equals("BOE") or calendarReportNode.param("reportingSystem").equals("FFIEC")
                                        or calendarReportNode.param("reportingSystem").equals("Internal") or calendarReportNode.param("reportingSystem").equals("PFRD")
                                        or calendarReportNode.param("reportingSystem").equals("FINMA") or calendarReportNode.param("reportingSystem").equals("BOE_OSCA")
                                        <then>
                                            specificTypes.add("ENTITY");
                                        </then>
                                    </case>
                                    <for>var j = param("specificKeyMappings").size() - 1 <comma/> j &gt; 0 or j == 0 <comma/> j--
                                        <do>
                                            param("specificKeyMappings").remove(j);
                                        </do>
                                    </for>

                                    <for>var j = 0 <comma/> j &lt; specificTypes.size() <comma/> j++
                                        <do>
                                            var row = tableRow();
                                            row.param("specificType") = specificTypes.get(j);
                                            param("specificKeyMappings").add(row);
                                        </do>
                                    </for>
                                </else>
                            </if>
                        </then>
                    </if>
                </onParameterChange>
                <verifyForSave>
                    <if>!param("mappingDisabled")
                        <then>
                            macro("verifyNonEmpty");
                        </then>
                    </if>
                </verifyForSave>
            </parameter>

            <parameter name="useXLSOutput" description="Use Excel Output for Submission" type="Boolean" defaultValue="false">
                <if>macro("getReportingSystem") == "BOE" or
                    macro("getReportingSystem") == "FSA" or
                    macro("getReportingSystem") == "BOE_OSCA" or
                    macro("getReportingSystem") == "FCA" or
                    ((macro("getReportingSystem") == "Generic" or macro("getReportingSystem") == "Generic2" or macro("getReportingSystem") == "Generic3") and "MappedReportingModule".equals(param("reportType")))
                    <then>
                        <removed/>
                    </then>
                    <else>
                        <if>macro("isEmpty", param("report"))
                            <then>
                                <disabled/>
                            </then>
                            <else>
                                <if>param("mappingDisabled")
                                    <then>
                                        <disabled/>
                                    </then>
                                    <else>
                                        <enabled/>
                                    </else>
                                </if>
                            </else>
                        </if>
                    </else>
                </if>

                <onParameterChange>
                    <if>oldValue != null
                        <then>
                            macro("updateWithLockOnCurrentTable");
                        </then>
                    </if>
                </onParameterChange>
            </parameter>
        </macro>

        <macro name="getPossibleReportObjects">
            var resolver = editor.getAxiomObjectManager().getResolver();
            var branchId = editor.createNameId("Branch", param("project") + "!" + param("branch"));
            <if>editor.getAxiomObjectManager().objectExists(branchId, editor.getAxiomEnvironment())
                <then>
                    var reports = editor.getRemoteProxy().lookupObjects(param("reportType"), resolver.resolve(branchId).getDbId());
                    ;reports
                </then>
                <else>
                    ;list()
                </else>
            </if>
        </macro>

        <macro name="onDateNodeAdded" arguments="dateNode">
            <dateNode/>.param("table_id") = function("axiomsl.util.UUID", "randomUUID").toString();
            <dateNode/>.setComparable(<dateNode/>.param("effectiveDate"));
            <dateNode/>.setName(function("axiomsl.util.basic.ObjectFormatter", "toGUIString", "dd-MMM-yyyy", <dateNode/>.param("effectiveDate")));

            <if><dateNode/>.param("report") != null &amp;&amp; <dateNode/>.param("report").length() > 0
                <then>
                    var found = false;
                    var foundNode = null;
                    macro("findReportObjectInNode", found, foundNode, <dateNode/>, <dateNode/>.param("report"));
                    <if>found
                        <then>
                            macro("updateReportObjectWithLock", <dateNode/>, foundNode);
                        </then>
                    </if>

                    var calendarReportNode = macro("getCalendarReportForNode", <dateNode/>);
                    var specificTypes = list();
                    <case>
                        calendarReportNode.param("reportingSystem").equals("FSA")
                        or calendarReportNode.param("reportingSystem").equals("FCA")
                        or calendarReportNode.param("reportingSystem").equals("Generic")
                        or calendarReportNode.param("reportingSystem").equals("Generic2")
                        or calendarReportNode.param("reportingSystem").equals("Generic3")
                        <then>
                            specificTypes.add("ENTITY+CONSOLIDATION_LEVEL");
                            specificTypes.add("MATERIAL_CURRENCY");
                        </then>
                        calendarReportNode.param("reportingSystem").equals("MAS") or calendarReportNode.param("reportingSystem").equals("RBI")
                        or calendarReportNode.param("reportingSystem").equals("HKMA") or calendarReportNode.param("reportingSystem").equals("BOK")
                        or calendarReportNode.param("reportingSystem").equals("FSS") or calendarReportNode.param("reportingSystem").equals("KFB")
                        or calendarReportNode.param("reportingSystem").equals("APRA") or calendarReportNode.param("reportingSystem").equals("BNM")
                        or calendarReportNode.param("reportingSystem").equals("HKSFC") or calendarReportNode.param("reportingSystem").equals("PBOC")
                        or calendarReportNode.param("reportingSystem").equals("SAFE") or calendarReportNode.param("reportingSystem").equals("CBRC")
                        or calendarReportNode.param("reportingSystem").equals("SEBI") or calendarReportNode.param("reportingSystem").equals("SEC")
                        or calendarReportNode.param("reportingSystem").equals("SAT") or calendarReportNode.param("reportingSystem").equals("FRB")
                        or calendarReportNode.param("reportingSystem").equals("FINRA")
                        <then>
                            specificTypes.add("ENTITY");
                            specificTypes.add("MATERIAL_CURRENCY");
                        </then>
                        calendarReportNode.param("reportingSystem").equals("BOE") or calendarReportNode.param("reportingSystem").equals("FFIEC")
                        or calendarReportNode.param("reportingSystem").equals("Internal") or calendarReportNode.param("reportingSystem").equals("PFRD")
                        or calendarReportNode.param("reportingSystem").equals("FINMA")  or calendarReportNode.param("reportingSystem").equals("BOE_OSCA")
                        <then>
                            specificTypes.add("ENTITY");
                        </then>
                    </case>

                    <for>var j = <dateNode/>.param("specificKeyMappings").size() - 1 <comma/> j &gt; 0 or j == 0 <comma/> j--
                        <do>
                            var addedSpecificType = <dateNode/>.param("specificKeyMappings").get(j).param("specificType");
                            <if>!specificTypes.contains(addedSpecificType)
                                <then>
                                    <dateNode/>.param("specificKeyMappings").remove(j);
                                </then>
                                <else>
                                    specificTypes.remove(addedSpecificType)
                                </else>
                            </if>
                        </do>
                    </for>

                    <for>var j = 0 <comma/> j &lt; specificTypes.size() <comma/> j++
                        <do>
                            var row = tableRow();
                            row.param("specificType") = specificTypes.get(j);
                            <dateNode/>.param("specificKeyMappings").add(row);
                        </do>
                    </for>
                </then>
            </if>
        </macro>

        <macro name="onNodeAdded">
            <if>addedNode.parent().level() == 2
                <then>
                    macro("onDateNodeAdded", addedNode);
                </then>
            </if>

            <if>addedNode.parent().level() == 1 and addedNode.getName() != "Common Mapping"
                <then>
                    <for>var c = 0 <comma/> c &lt; addedNode.childCount() <comma/> c++
                        <do>
                            macro("onDateNodeAdded", addedNode.child(c));
                        </do>
                    </for>

                </then>
            </if>
        </macro>

        <macro name="clearTable" arguments="table">
            <if><table/>!= null
                <then>
                    <for>var k =<table/>.size() - 1 <comma/> k &gt; 0 || k == 0; <comma/> k--
                        <do>
                            <table/>.remove(k)
                        </do>
                    </for>
                </then>
            </if>
        </macro>

        <macro name="updateReportObjectWithLock" arguments="node, sourceNode">
            <if>param("currentTable") == null || param("currentTable").length() == 0
                <then>
                    <try>
                        param("currentTable") = <node/>.param("table_id");
                        macro("updateReportObjectInNode", <node/>, <sourceNode/>);
                        param("currentTable") = "";
                        <catch>var e</catch>
                        param("currentTable") = "";
                        e.printStackTrace();
                        message(e.getMessage());
                    </try>
                </then>
            </if>
        </macro>

        <macro name="updateCurrentReportObjectWithLock" arguments="sourceNode">
            macro("updateReportObjectWithLock", currentNode, <sourceNode/>);
        </macro>

        <macro name="updateReportObjectInNode" arguments="node, sourceNode">
            var specificKeyMappings = <node/>.param("specificKeyMappings");
            <!--macro("clearTable", specificKeyMappings);-->

            var sourceSpecificKeyMappings =<sourceNode/>.param("specificKeyMappings");
            <for>var k = 0 <comma/> k &lt; sourceSpecificKeyMappings.size() <comma/> k++
                <do>
                    var sourceSpecificKeyMapping = sourceSpecificKeyMappings.get(k);

                    var skmIndex = 0;
                    <for> <comma/> skmIndex &lt; specificKeyMappings.size() <comma/> skmIndex++
                        <do>
                            var specificKeyMapping = specificKeyMappings.get(skmIndex);
                            <if>sourceSpecificKeyMapping.param("specificType").equals(specificKeyMapping.param("specificType"))
                                <then>
                                    <if>macro("isEmpty", specificKeyMapping.param("keyType")) and macro("isEmpty",  sourceSpecificKeyMapping.param("keyType"))
                                         <else>
                                             specificKeyMapping.param("keyType") = sourceSpecificKeyMapping.param("keyType");
                                         </else>
                                    </if>
                                    <if>macro("isEmpty", specificKeyMapping.param("keyName")) and macro("isEmpty",  sourceSpecificKeyMapping.param("keyName"))
                                         <else>
                                             specificKeyMapping.param("keyName") = sourceSpecificKeyMapping.param("keyName");
                                         </else>
                                    </if>
                                    break;
                                </then>
                            </if>
                        </do>
                    </for>
                    <if>skmIndex == specificKeyMappings.size()
                        <then>
                            var row = tableRow();
                            row.param("specificType") = sourceSpecificKeyMapping.param("specificType");

                            row.param("keyType") = sourceSpecificKeyMapping.param("keyType");
                            row.param("keyName") = sourceSpecificKeyMapping.param("keyName");
                            specificKeyMappings.add(row);
                        </then>
                    </if>
                </do>
            </for>

            <if>macro("isEmpty",  <node/>.param("useXLSOutput")) and macro("isEmpty",  <sourceNode/>.param("useXLSOutput"))
                <else>
                    <node/>.param("useXLSOutput") = <sourceNode/>.param("useXLSOutput");
                </else>
            </if>
        </macro>

        <macro name="getCalendarReportNode">
            macro("getCalendarReportForNode",currentNode);
        </macro>

        <macro name="getReportingSystem">
            var calendarReportNode = macro("getCalendarReportNode");
            ;calendarReportNode.param("reportingSystem")
        </macro>

        <macro name="getCalendarReportForNode" arguments="node">
            var parentNode = <node/>;
            <for><comma/> parentNode != null and parentNode.type() != "EnterpriseReportMapping:report"<comma/>
                <do>
                     parentNode = parentNode.parent()
                </do>
            </for>
            ;parentNode
        </macro>

        <macro name="findReportObjectInCurrentNode" arguments="found, foundNode, reportName">
            macro("findReportObjectInNode", <found/>, <foundNode/>, currentNode, <reportName/>);
        </macro>

        <macro name="findReportObjectInNode" arguments="found, foundNode, node, reportName">
            <found/> = false;
            <foundNode/> = null;
            var calendarReportNode = macro("getCalendarReportForNode", <node/>);
            <for>var i = 0 <comma/> i &lt; calendarReportNode.childCount(); <comma/> i++
                <do>
                    var node = calendarReportNode.child(i);
                    <for>var j = 0 <comma/> j &lt; node.childCount(); <comma/> j++
                        <do>
                            var firmNode = node.child(j);
                            <if>firmNode != <node/>
                                and !firmNode.param("mappingDisabled")
                                and firmNode.param("project").equals(<node/>.param("project"))
                                and firmNode.param("branch").equals(<node/>.param("branch"))
                                and firmNode.param("reportType").equals(<node/>.param("reportType"))
                                and firmNode.param("report").equals(<reportName/>)
                                <then>
                                    <found/> = true;
                                    <foundNode/> = firmNode;
                                    break;
                                </then>
                            </if>
                        </do>
                    </for>
                    <if>
                        <found/>
                        <then>break;</then>
                    </if>
                </do>
            </for>
        </macro>

        <macro name="validationRuleParameter">
            <parameter name="validationRule" description="Validation Rule" type="String">
                <attribute name="lookupFromNamedList">"Validation Rule"
                    <comma/>
                    var resolver = editor.getAxiomObjectManager().getResolver();
                    var branchId = resolver.resolve( editor.createNameId("Branch", param("project") + "!" + param("branch")));
                    editor.getRemoteProxy().getObjectList("ValidationRule", branchId.getDbId());
                </attribute>
                <convertInputValue>
                    inputValue.getName();
                </convertInputValue>
                <!--<verifyForSave>-->
                    <!--macro("verifyNonEmpty");-->
                <!--</verifyForSave>-->
                <if>macro("isEmpty", param("branch"))
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <enabled/>
                    </else>
                </if>
                <validation>
                    macro("checkObjectExists", "ValidationRule", newValue, true);
                </validation>
            </parameter>
        </macro>

        <macro name="workflowParameter">
            <parameter name="workflow" description="WorkFlow" type="string">
                <attribute name="lookupFromNamedList">"WorkFlow"
                    <comma/>
                    var resolver = editor.getAxiomObjectManager().getResolver();
                    var branchId = resolver.resolve( editor.createNameId("Branch", param("project") + "!" + param("branch")));
                    editor.getRemoteProxy().getObjectList("WorkFlow", branchId.getDbId());
                </attribute>
                <convertInputValue>
                    inputValue.getName();
                </convertInputValue>
                <if>macro("isEmpty", param("branch"))
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <enabled/>
                    </else>
                </if>
                <!--<verifyForSave>-->
                    <!--<if>!(currentNode.parent().level() == 1 and macro("isEmpty", param("validationRule")))-->
                        <!--and macro("isEmpty", currentParameter.getParameterValue())-->
                        <!--<then>-->
                            <!--errorMessage("If validation rule is specified the workflow must not be empty");-->
                            <!--false-->
                        <!--</then>-->
                    <!--</if>-->
                <!--</verifyForSave>-->
                <validation>
                    macro("checkObjectExists", "WorkFlow", newValue, true);
                </validation>
            </parameter>
        </macro>

        <macro name="checkObjectIsValid" arguments="objectType, objectName, needReturn">
            var errorMsg = null;
            <if>!macro("isEmpty",<objectName/>)
                <then>
                    var name = macro("getName",<objectName/>);
                    var resolver = editor.getAxiomObjectManager().getResolver();
                    var branchId = resolver.resolve(editor.createNameId("Branch", param("project") + "!" + param("branch")));

                    var objectId = function("axiomsl.server.object_framework.ObjectID", "createNameId",<objectType/>, branchId.getDbId(), name);
                    <if>!editor.getAxiomObjectManager().objectExists(objectId, editor.getAxiomEnvironment())
                        <then>
                            errorMsg = l("%1 '%2' doesn't exist!",<objectType/>, param("project") + "!" + param("branch") + ":" + name);
                        </then>
                        <else>
                            <if>resolver.getObjectEntry(resolver.resolve(objectId)).isInvalid()
                                <then>
                                    errorMsg = l("%1 '%2' is invalid!",<objectType/>, param("project") + "!" + param("branch") + ":" + name);
                                </then>
                                <else>
                                    errorMsg = null;
                                </else>
                            </if>
                        </else>
                    </if>
                </then>
                <else>
                    errorMsg = l("%1 cannot be empty",<objectType/>);
                </else>
            </if>
            <if>errorMsg != null
                <then>
                    <if>
                        <needReturn/>
                        <then>
                            return errorMsg;
                        </then>
                        <else>
                            errorMessage(errorMsg);
                            false
                        </else>
                    </if>
                </then>
                <else>
                    true
                </else>
            </if>
        </macro>

        <macro name="updateReportObjectInNodes">
            var calendarReportNode = macro("getCalendarReportForNode", currentNode);
            <for>var i = 0 <comma/> i &lt; calendarReportNode.childCount() <comma/> i++
                <do>
                    var node = calendarReportNode.child(i);
                    <for>var j = 0 <comma/> j &lt; node.childCount() <comma/> j++
                        <do>
                            var firmNode = node.child(j);
                            <if>firmNode != currentNode
                                and !firmNode.param("mappingDisabled")
                                and firmNode.param("project").equals(currentNode.param("project"))
                                and firmNode.param("branch").equals(currentNode.param("branch"))
                                and firmNode.param("reportType").equals(currentNode.param("reportType"))
                                and firmNode.param("report").equals(currentNode.param("report"))
                                <then>
                                    macro("updateReportObjectInNode", firmNode, currentNode);
                                </then>
                            </if>
                        </do>
                    </for>

                </do>
            </for>
        </macro>

        <macro name="specificKeyMappingsParameter" arguments="firmType">
            <parameter name="table_id" type="string" description="Table Id" hidden="true"/>

            <parameter name="specificKeyMappings" description="Specific Key Mappings" type="table" length="3" allowAddRemove="false" reorder="false">
                <default>
                    var rows = list();
                    <case>
                        <firmType/>.equals("FSA") or <firmType/>.equals("FCA") or <firmType/>.equals("Generic") or <firmType/>.equals("Generic2") or <firmType/>.equals("Generic3")
                        <then>
                            var row1 = tableRow();
                            row1.param("specificType") = "ENTITY+CONSOLIDATION_LEVEL";
                            rows.add(row1);
                            var row2 = tableRow();
                            row2.param("specificType") = "MATERIAL_CURRENCY";
                            rows.add(row2);
                        </then>
                        <firmType/>.equals("MAS") or <firmType/>.equals("RBI") or <firmType/>.equals("HKMA") or <firmType/>.equals("BOK")
                        or <firmType/>.equals("FSS") or <firmType/>.equals("KFB") or <firmType/>.equals("APRA") or <firmType/>.equals("BNM")
                        or <firmType/>.equals("HKSFC") or <firmType/>.equals("PBOC") or <firmType/>.equals("SAFE") or <firmType/>.equals("CBRC")
                        or <firmType/>.equals("SEBI") or <firmType/>.equals("SEC") or <firmType/>.equals("FRB") or <firmType/>.equals("FINRA")
                        or <firmType/>.equals("SAT")
                        <then>
                            var row1 = tableRow();
                            row1.param("specificType") = "ENTITY";
                            rows.add(row1);
                            var row2 = tableRow();
                            row2.param("specificType") = "MATERIAL_CURRENCY";
                            rows.add(row2);
                        </then>
                        <firmType/>.equals("BOE") or <firmType/>.equals("FFIEC") or <firmType/>.equals("Internal") or <firmType/>.equals("PFRD")
                        or <firmType/>.equals("FINMA") or <firmType/>.equals("BOE_OSCA")
                        <then>
                            var row = tableRow();
                            row.param("specificType") = "ENTITY";
                            rows.add(row);
                        </then>
                    </case>
                    return rows;
                </default>

                <parameter name="specificType" description="Specific Type" type="String">
                    <readonly/>
                </parameter>

                <parameter name="keyType" description="Key Type" type="String">
                    <if>macro("isEmpty", param("report"))
                        <then>
                            <disabled/>
                        </then>
                        <else>
                            <enabled/>
                            choices(asDescription(list(ndo("NONE",l("NONE")), ndo("STREAM_KEY", l("STREAM_KEY")), ndo("INSTANCE_KEY", l("INSTANCE_KEY")))));
                        </else>
                    </if>

                    <onParameterChange>
                        <if>oldValue != null
                            <then>
                                var oldLock = param("currentTable");
                                param("currentTable") = param("table_id");
                                <if>param("keyName") != null
                                    <then>
                                        param("keyName") = "";
                                    </then>
                                </if>
                                param("currentTable") = oldLock;

                                macro("updateWithLockOnCurrentTable");
                            </then>
                        </if>
                    </onParameterChange>
                </parameter>
                <parameter name="keyName" description="Key Name" type="String">
                    <if>macro("isEmpty", param("report")) or param("keyType") == null or param("keyType").equals("NONE")
                        <then>
                            <disabled/>
                        </then>
                        <else>
                            <enabled/>
                        </else>
                    </if>
                    <attribute name="lookupFromValues">l("Key Name")
                        <comma/>
                        macro("getSpecificKeyNames");
                    </attribute>
                    <onParameterChange>
                        <if>oldValue != null
                            <then>
                                macro("updateWithLockOnCurrentTable");
                            </then>
                        </if>
                    </onParameterChange>
                    <verifyForSave>
                        macro("verifyNonEmpty");
                    </verifyForSave>
                    <validation>
                        <if>!macro("isEmpty", newValue)
                            <then>
                                var names = macro("getSpecificKeyNames");
                                <if>names.indexOf(newValue) &lt; 0
                                    <then>
                                        return l("%1 '%2' doesn't exist in %3 '%4'!", param("keyType"), newValue, param("reportType"), param("report"));
                                    </then>
                                </if>
                            </then>
                        </if>
                    </validation>
                </parameter>
            </parameter>
        </macro>

        <macro name="updateWithLockOnCurrentTable">
            <if>param("currentTable") == null || param("currentTable").length() == 0
                <then>
                    <try>
                        param("currentTable") = param("table_id");
                        macro("updateReportObjectInNodes");
                        param("currentTable") = "";
                        <catch>var e</catch>
                        param("currentTable") = "";
                        e.printStackTrace();
                        message(e.getMessage());
                    </try>
                </then>
            </if>
        </macro>

        <macro name="setReferenceProperty" arguments="object, propertyName, refObjectType, branchId, nameParameter">
            <if><nameParameter/>!= null and <nameParameter/>.length() > 0
                <then>
                    var routeToBranch = function("axiomsl.server.object_framework.RouteToObject", "createIdRoute", mapping,<branchId/>);
                    var refObjectId = function("axiomsl.server.object_framework.ObjectID", "createNameId",<refObjectType/>,<branchId/>,<nameParameter/>);
                    var refObject = editor.getAxiomObjectManager().locate(refObjectId);
                    <object/>.setProperty(<propertyName/>,<object/>.createReferencePropertyValue(routeToBranch, refObject));
                </then>
            </if>
        </macro>

        <macro name="saveKeyValuesMappingTable" arguments="tableParameter, specificType, mappingObject">
            var specificValuesMappingTable =<tableParameter/>;
            <if>specificValuesMappingTable != null and specificValuesMappingTable.size() &gt; 0
                <then>
                    var specificValuesMapping =<mappingObject/>.getTable("specificValuesMapping").addRow("EnterpriseReportMapping:specificValuesMapping");
                    specificValuesMapping.setProperty("specificType",<specificType/>);
                    <for>var l = 0 <comma/> l &lt; specificValuesMappingTable.size(); <comma/> l++
                        <do>
                            var row = specificValuesMappingTable.get(l);
                            var keyValuesMapping = specificValuesMapping.getTable("keyValuesMapping").addRow("EnterpriseReportMapping:keyValuesMapping");
                            <if>row.param("keyValue").equalsIgnoreCase("ALL") and "MATERIAL_CURRENCY".equals(<specificType/>)
                                <then>
                                    keyValuesMapping.setProperty("keyValue", "all");
                                </then>
                                <else>
                                    keyValuesMapping.setProperty("keyValue", row.param("keyValue"));
                                </else>
                            </if>

                            var specificValues = keyValuesMapping.getTable("specificValues");

                            var entityValue = row.getParam("entityValue");
                            <if>entityValue != null
                                <then>
                                    specificValues.addRow("EnterpriseReportMapping:specificValues").setProperty("specificValue", row.param("entityValue"));
                                </then>
                            </if>
                            specificValues.addRow("EnterpriseReportMapping:specificValues").setProperty("specificValue", row.param("specificValue"));

                        </do>
                    </for>
                </then>
            </if>
        </macro>

        <macro name="loadKeyValuesMappingTable" arguments="tableParameter, specificType, mappingObject">
            <tableParameter/>;

            var specificValuesMapping =<mappingObject/>.getTable("specificValuesMapping");
            var ind = -1;
            <for>var l = 0 <comma/> l &lt; specificValuesMapping.size(); <comma/> l++
                <do>
                    <if>specificValuesMapping.get(l).getProperty("specificType").equals(<specificType/>)
                        <then>
                            ind = l;
                            break;
                        </then>
                    </if>
                </do>
            </for>

            <if>ind == 0 || ind &gt; 0
                <then>
                    var keyValueMappings = specificValuesMapping.get(ind).getTable("keyValuesMapping");
                    tableRows = list();
                    <for>var l = 0 <comma/> l &lt; keyValueMappings.size() <comma/> l++
                        <do>
                            var keyValueMapping = keyValueMappings.get(l);
                            var row = tableRow();
                            <if>keyValueMapping.getTable("specificValues").size() > 1
                                <then>
                                    row.param("entityValue") = keyValueMapping.getTable("specificValues").get(0).getProperty("specificValue");
                                    row.param("specificValue") = keyValueMapping.getTable("specificValues").get(1).getProperty("specificValue");
                                </then>
                                <else>
                                    <if>keyValueMapping.getTable("specificValues").size() > 0
                                        <then>
                                            row.param("specificValue") = keyValueMapping.getTable("specificValues").get(0).getProperty("specificValue");
                                        </then>
                                    </if>
                                </else>
                            </if>

                            <if>keyValueMapping.getProperty("keyValue").equalsIgnoreCase("ALL") and "MATERIAL_CURRENCY".equals(<specificType/>)
                                <then>
                                    row.param("keyValue") = "ALL";
                                </then>
                                <else>
                                    row.param("keyValue") = keyValueMapping.getProperty("keyValue");
                                </else>
                            </if>

                            tableRows.add(row);
                        </do>
                    </for>
                    <tableParameter/>
                    = tableRows;
                </then>
            </if>
        </macro>

        <macro name="loadMapping" arguments="parentNode, mappingObject, reportingSystem">
            var effectiveDate = <mappingObject/>.getProperty("effectiveDate");
            var effectiveDateNode = <parentNode/>.createChild("effectiveDateNode", function("axiomsl.util.basic.ObjectFormatter", "toGUIString", "dd-MMM-yyyy", effectiveDate));
            effectiveDateNode.setComparable(effectiveDate);
            effectiveDateNode.param("effectiveDate") = effectiveDate;

            macro("safeRowParamInit", effectiveDateNode, "mappingDisabled", <mappingObject/>, "disabled", false);

            effectiveDateNode.param("specificKeyMappings");
            effectiveDateNode.param("table_id") = function("axiomsl.util.UUID", "randomUUID").toString();

            <if>!effectiveDateNode.param("mappingDisabled")
            <then>
            var mainReport = <mappingObject/>.getProperty("mainReport").getTargetObject();
            var reportObjectName = mainReport.getProperty("reportObject").getTargetObjectName();
            effectiveDateNode.param("branch") = reportObjectName.substring(reportObjectName.lastIndexOf("!") + 1, reportObjectName.lastIndexOf(":"));
            var projectName = reportObjectName.substring(0, reportObjectName.lastIndexOf("!"));
            effectiveDateNode.param("project") = projectName.substring(projectName.lastIndexOf("!") + 1);

            effectiveDateNode.param("reportType") = mainReport.getProperty("reportObject").getTargetObjectType();
            effectiveDateNode.param("report") = mainReport.getProperty("reportObject").getTargetObjectNativeNameWithoutPrefix();
            macro("safeRowParamInit", effectiveDateNode, "useXLSOutput", mainReport, "useXLSOutput", false);
            <!--var calReportNode = macro("getCalendarReportForNode", effectiveDateNode);-->
            <!--macro("addReportObject", effectiveDateNode.param("project"), effectiveDateNode.param("branch"), effectiveDateNode.param("reportType"), effectiveDateNode.param("report"), calReportNode.getName());-->

            var specificKeyMappings = mainReport.getTable("specificKeyMappings");
            var specificTypesByFirm = list();
            <case>
                reportingSystem == "FSA" or reportingSystem == "FCA" or reportingSystem == "Generic" or reportingSystem == "Generic2" or reportingSystem == "Generic3"
                <then>
                    specificTypesByFirm = array("ENTITY+CONSOLIDATION_LEVEL", "MATERIAL_CURRENCY");
                </then>
                reportingSystem == "BOE" or reportingSystem == "FFIEC" or reportingSystem == "Internal"
                or reportingSystem == "PFRD" or reportingSystem == "FINMA" or reportingSystem == "BOE_OSCA"
                <then>
                    specificTypesByFirm = array("ENTITY");
                </then>
                reportingSystem == "MAS" or reportingSystem == "RBI" or reportingSystem == "HKMA" or reportingSystem == "BOK"
                or reportingSystem == "FSS" or reportingSystem == "KFB" or reportingSystem == "APRA" or reportingSystem == "BNM"
                or reportingSystem == "HKSFC" or reportingSystem == "PBOC" or reportingSystem == "SAFE" or reportingSystem == "CBRC"
                or reportingSystem == "SEBI" or reportingSystem == "SEC" or reportingSystem == "FRB" or reportingSystem == "FINRA"
                or reportingSystem == "SAT"
                <then>
                    specificTypesByFirm = array("ENTITY", "MATERIAL_CURRENCY");
                </then>
            </case>

            var tableRows = list();
            <for>var l = 0 <comma/> l &lt; specificTypesByFirm.size() <comma/> l++
                <do>
                    var skmIndex = 0;
                    <for> <comma/> skmIndex &lt; specificKeyMappings.size() <comma/> skmIndex++
                        <do>
                            var specificKeyMapping = specificKeyMappings.get(skmIndex);

                            var specificType = specificKeyMapping.getProperty("specificType");
                            <if>specificTypesByFirm.get(l).equals(specificType)
                                <then>
                                    var row = tableRow();
                                    row.param("specificType") = specificType;
                                    row.param("keyType") = specificKeyMapping.getProperty("keyType");
                                    macro("safeRowParamInit", row, "keyName", specificKeyMapping, "keyName", "");
                                    tableRows.add(row);
                                    break;
                                </then>
                            </if>
                        </do>
                    </for>
                    <if>skmIndex == specificKeyMappings.size()
                        <then>
                            var row = tableRow();
                            row.param("specificType") = specificTypesByFirm.get(l);
                            row.param("keyType");
                            row.param("keyName");
                            tableRows.add(row);
                        </then>
                    </if>
                </do>
            </for>


            effectiveDateNode.param("specificKeyMappings") = tableRows;
            <if>reportingSystem.equals("FSA") or reportingSystem.equals("FCA") or reportingSystem.equals("Generic") or reportingSystem.equals("Generic2") or reportingSystem.equals("Generic3")
                <then>
                    macro("loadKeyValuesMappingTable", effectiveDateNode.param("consolidationLevelValueMappings"), "ENTITY+CONSOLIDATION_LEVEL",<mappingObject/>);
                </then>
                <else>
                    macro("loadKeyValuesMappingTable", effectiveDateNode.param("valueMappings"), "ENTITY",<mappingObject/>);
                </else>
            </if>
            <if>reportingSystem == "FSA" or reportingSystem == "MAS" or reportingSystem == "RBI" or reportingSystem == "HKMA" or reportingSystem == "BOK"
                or reportingSystem == "FSS" or reportingSystem == "KFB" or reportingSystem == "APRA" or reportingSystem == "BNM" or reportingSystem == "HKSFC"
                or reportingSystem == "PBOC" or reportingSystem == "SAFE" or reportingSystem == "CBRC" or reportingSystem == "SEBI" or reportingSystem == "SEC"
                or reportingSystem == "FRB" or reportingSystem == "FINRA" or reportingSystem == "SAT" or reportingSystem == "FCA" or reportingSystem == "Generic" or reportingSystem == "Generic2" or reportingSystem == "Generic3"
                <then>
                    macro("loadKeyValuesMappingTable", effectiveDateNode.param("materialCurrencyValueMappings"), "MATERIAL_CURRENCY",<mappingObject/>);
                </then>
            </if>
            </then>
                <else>
                    effectiveDateNode.param("branch") = "";
                    effectiveDateNode.param("project") = "";
                    effectiveDateNode.param("reportType") = "";
                    effectiveDateNode.param("report") = "";
                </else>
            </if>

            <if><reportingSystem/>.equals("FFIEC")
                <then>
                    <if><mappingObject/>.propertyIsSet("workFlow")
                        <then>
                            var workflowRef =<mappingObject/>.getReference("workFlow");
                            effectiveDateNode.param("workflow") = workflowRef.getTargetObjectNativeName();
                        </then>
                        <else>
                            effectiveDateNode.param("workflow") = "";
                        </else>
                    </if>

                    <if><mappingObject/>.propertyIsSet("validationRule")
                        <then>
                            var validationRuleRef =<mappingObject/>.getReference("validationRule");
                            effectiveDateNode.param("validationRule") = validationRuleRef.getTargetObjectNativeName();
                        </then>
                        <else>
                            effectiveDateNode.param("validationRule") = "";
                        </else>
                    </if>
                </then>
            </if>

            effectiveDateNode.addToParent();
        </macro>

        <macro name="saveMapping" arguments="effectiveDateNode, mappingObject, reportingSystem">
            <mappingObject/>.setProperty("effectiveDate", <effectiveDateNode/>.param("effectiveDate"));
            <mappingObject/>.setProperty("disabled", <effectiveDateNode/>.param("mappingDisabled"));

            <if> !<effectiveDateNode/>.param("mappingDisabled")
            <then>
            var branchName = <effectiveDateNode/>.param("project") + "!" + <effectiveDateNode/>.param("branch");
            var branchId = resolver.resolve(editor.createNameId("Branch", branchName)).getDbId();
            <if>reportingSystem == "FFIEC"
                <then>
                    macro("setReferenceProperty",<mappingObject/>, "workFlow", "WorkFlow", branchId,<effectiveDateNode/>.param("workflow"));
                    macro("setReferenceProperty",<mappingObject/>, "validationRule", "ValidationRule", branchId,<effectiveDateNode/>.param("validationRule"));
                </then>
            </if>

            var reportObjectId = function("axiomsl.server.object_framework.ObjectID", "createNameId",<effectiveDateNode/>.param("reportType"), branchId,<effectiveDateNode/>.param("report"));

            var mainReport = null;
            <for>var l = 0 <comma/> l &lt; reportObjects.size() <comma/> l++
                <do>
                    var currentReportObjectRef = reportObjects.get(l).getReference("reportObject");
                    var currentReportObjectId = function("axiomsl.server.object_framework.ObjectID", "createNameId", currentReportObjectRef.getTargetObjectType(),
                    currentReportObjectRef.getRouteToTarget().getTargetBranchId(), currentReportObjectRef.getTargetObjectNativeNameWithoutPrefix());

                    <if>reportObjectId.equals(currentReportObjectId);
                        <then>
                            mainReport = reportObjects.get(l);
                            break;
                        </then>
                    </if>
                </do>
            </for>
            <if>mainReport == null
                <then>
                    mainReport = reportObjects.addRow("EnterpriseReportMapping:reportObject");
                    var uuid = function("axiomsl.util.UUID", "randomUUID").toString();
                    mainReport.setProperty("name", "reportObject_" + uuid);
                    mainReport.setProperty("id", uuid);
                    mainReport.setProperty("reportObject", mainReport.createReferencePropertyValue(<effectiveDateNode/>.param("reportType"), branchName + ":" + <effectiveDateNode/>.param("report")));

                    <if><effectiveDateNode/>.param("useXLSOutput") != null
                        <then>
                            mainReport.setProperty("useXLSOutput", <effectiveDateNode/>.param("useXLSOutput"));
                        </then>
                    </if>

                    var specificKeyMappings =<effectiveDateNode/>.param("specificKeyMappings");
                    <for>var l = 0 <comma/> l &lt; specificKeyMappings.size(); <comma/> l++
                        <do>
                            var row = specificKeyMappings.get(l);
                            var specificKeyMapping = mainReport.getTable("specificKeyMappings").addRow("EnterpriseReportMapping:specificKeyMapping");
                            specificKeyMapping.setProperty("specificType", row.param("specificType"));
                            specificKeyMapping.setProperty("keyType", row.param("keyType"));

                            <if>row.param("keyName")!=null
                            <then>
                                 specificKeyMapping.setProperty("keyName", row.param("keyName"));
                            </then>
                            </if>

                        </do>
                    </for>

                </then>
            </if>

            var mainReportRef =<mappingObject/>.createReferencePropertyValue(routeToMapping, array(mapping, "mappings", report, "reportObjects", mainReport));
            <mappingObject/>.setProperty("mainReport", mainReportRef);

            <if>reportingSystem == "FSA" or reportingSystem == "FCA" or reportingSystem == "Generic" or reportingSystem == "Generic2" or reportingSystem == "Generic3"
                <then>
                    macro("saveKeyValuesMappingTable",<effectiveDateNode/>.param("consolidationLevelValueMappings"), "ENTITY+CONSOLIDATION_LEVEL",<mappingObject/>);
                </then>
                <else>
                    macro("saveKeyValuesMappingTable",<effectiveDateNode/>.param("valueMappings"), "ENTITY",<mappingObject/>);
                </else>
            </if>
            <if>reportingSystem == "FSA" or reportingSystem == "MAS" or reportingSystem == "RBI" or reportingSystem == "HKMA" or reportingSystem == "BOK"
                or reportingSystem == "FSS" or reportingSystem == "KFB" or reportingSystem == "APRA" or reportingSystem == "BNM" or reportingSystem == "HKSFC"
                or reportingSystem == "PBOC" or reportingSystem == "SAFE" or reportingSystem == "CBRC" or reportingSystem == "SEBI" or reportingSystem == "SEC"
                or reportingSystem == "FRB" or reportingSystem == "FINRA" or reportingSystem == "SAT" or reportingSystem == "FCA"  or reportingSystem.equals("Generic") or reportingSystem.equals("Generic2") or reportingSystem.equals("Generic3")
                <then>
                    macro("saveKeyValuesMappingTable",<effectiveDateNode/>.param("materialCurrencyValueMappings"), "MATERIAL_CURRENCY",<mappingObject/>);
                </then>
            </if>
            </then>
            </if>
        </macro>

        <macro name="getSpecificKeyNames">
            var resolver = editor.getAxiomObjectManager().getResolver();
            var branchId = resolver.resolve(editor.createNameId("Branch", param("project") + "!" + param("branch")));
            var reportObjectId = function("axiomsl.server.object_framework.ObjectID", "createNameId", param("reportType"), branchId.getDbId(), param("report"));
            var report = editor.getAxiomObjectManager().locate(reportObjectId);
            var set = new("java.util.HashSet");
            var modelBasedTaskConfig = editor.getAxiomObjectManager().locate(function("axiomsl.server.object_framework.ObjectID", "createNameId", "ModelBasedTaskConfig", branchId.getDbId(), report.getObjectType() + "[" + report.getName() + "]"));


            <if>param("keyType").equals("STREAM_KEY")
                <then>
                    var streams = modelBasedTaskConfig.getTable("streamKeys");
                    <for>var i = 0
                        <comma/>
                        i &lt; streams.size();
                        <comma/>
                        i++
                        <do>
                            set.add(streams.get(i).getProperty("streamKeyName"));
                        </do>
                    </for>
                </then>
                <else>
                    <if>param("keyType").equals("INSTANCE_KEY")
                        <then>
                            var instanceKeys = modelBasedTaskConfig.getTable("instanceKeys");
                            <for>var i = 0
                                <comma/>
                                i &lt; instanceKeys.size();
                                <comma/>
                                i++
                                <do>
                                    set.add(instanceKeys.get(i).getProperty("name"));
                                </do>
                            </for>
                        </then>
                    </if>
                </else>
            </if>

            ;new("java.util.Vector", set)
        </macro>

        <macro name="checkSpecificKeyTypeIsNone" arguments="specificType">
            <for>var i = 0 <comma/> param("specificKeyMappings") != null and i &lt; param("specificKeyMappings").size() <comma/> i++
                <do>
                    var keyType = param("specificKeyMappings").get(i).param("keyType");
                    <if>param("specificKeyMappings").get(i).param("specificType").equals(<specificType/>)
                        <then>
                            <if> keyType == null or keyType.equals("NONE")
                                <then>
                                    <disabled/>
                                </then>
                                <else>
                                    <enabled/>
                                </else>
                            </if>
                            break;
                        </then>
                    </if>
                </do>
            </for>
        </macro>

        <macro name="consolidationLevelValueMappingsParameter">
            <parameter name="consolidationLevelValueMappings" description="Consolidation Level and Entity Value Mappings" type="table" length="5">
                <if>macro("isEmpty", param("report"))
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <if>param("mappingDisabled")
                            <then>
                                <disabled/>
                            </then>
                            <else>
                                <enabled/>
                                macro("checkSpecificKeyTypeIsNone", "ENTITY+CONSOLIDATION_LEVEL");
                            </else>
                        </if>
                    </else>
                </if>
                <parameter name="entityValue" description="Entity Value" type="string"/>
                <parameter name="specificValue" description="Colsolidation Level Value" type="string">
                    choices(asDescription(list(
                    ndo("unconsolidated", l("unconsolidated")),
                    ndo("solo-consolidated", l("solo-consolidated")),
                    ndo("UK consolidation group", l("UK consolidation group")),
                    ndo("stock liquidity group", l("stock liquidity group")),
                    ndo("banking conglomerate", l("banking conglomerate")),
                    ndo("investment conglomerate", l("investment conglomerate")),
                    ndo("UK integrated group", l("UK integrated group")),
                    ndo("DLG by default", l("DLG by default")),
                    ndo("UK DLG by modification", l("UK DLG by modification")),
                    ndo("Non-UK DLG by modification", l("Non-UK DLG by modification")),
                    ndo("liquidity consolidation", l("liquidity consolidation")),
                    ndo("domestic liquidity sub group", l("domestic liquidity sub group")),
                    ndo("non domestic liquidity sub group", l("non domestic liquidity sub group")),
                    ndo("prudential consolidation", l("prudential consolidation")))));
                </parameter>
                <parameter name="keyValue" description="Key Value" type="string"/>
            </parameter>
        </macro>

        <macro name="materialCurrencyValueMappingsParameter">
            <parameter name="materialCurrencyValueMappings" description="Material Currency Value Mappings" type="table" length="5">
                <if>macro("isEmpty", param("report"))
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <if>param("mappingDisabled")
                            <then>
                                <disabled/>
                            </then>
                            <else>
                                <enabled/>
                                macro("checkSpecificKeyTypeIsNone", "MATERIAL_CURRENCY");
                            </else>
                        </if>
                    </else>
                </if>
                <parameter name="specificValue" description="Specific Value" type="string" defaultValue="consolidated"/>

                <parameter name="keyValue" description="Key Value" type="string">
                    <editable/>
                    choices(asDescription(ndo("ALL",l("ALL"))));
                </parameter>
            </parameter>
        </macro>

        <macro name="entityValueMappingsParameter">
            <parameter name="valueMappings" description="Entity Value Mappings" type="table" length="5">
                <if>macro("isEmpty", param("report"))
                    <then>
                        <disabled/>
                    </then>
                    <else>
                        <if>param("mappingDisabled")
                            <then>
                                <disabled/>
                            </then>
                            <else>
                                <enabled/>
                                macro("checkSpecificKeyTypeIsNone", "ENTITY");
                            </else>
                        </if>
                    </else>
                </if>
                <parameter name="specificValue" description="Specific Value" type="string"/>
                <parameter name="keyValue" description="Key Value" type="string"/>
            </parameter>
        </macro>

        <macro name="updateReports" arguments="reportingSystem, paramName">
            var calendar = editor.locateObjectById("EnterpriseReportCalendar", "EnterpriseReportCalendar");
            var reports = calendar.getTable("reports").getAllRows();
            <for>var j = param(<paramName/>).childCount() - 1
                <comma/>
                j &gt; 0 or j == 0
                <comma/>
                j--
                <do>
                    var found = false;
                    <for>var i = 0; <comma/> i &lt; reports.size() <comma/> i++
                        <do>
                            var report = reports.get(i);
                            var reportingSystem = report.getProperty("reportingSystem");
                            <if>reportingSystem.equals(<reportingSystem/>);
                                <then>
                                    <if>report.getProperty("id").equals(param(<paramName/>).child(j).param("calendarReportId"))
                                        <then>
                                            <if>!report.getProperty("name").equals(param(<paramName/>).child(j).getName())
                                                <then>
                                                    param(<paramName/>).child(j).setName(report.getProperty("name"));
                                                </then>
                                            </if>
                                            reports.remove(report);
                                            found = true;
                                            break;
                                        </then>
                                    </if>
                                </then>
                            </if>
                        </do>
                    </for>
                    <if>!found
                        <then>
                            param(<paramName/>).remove(j);
                        </then>
                    </if>
                </do>
            </for>

            <for>var i = 0 <comma/>  i &lt; reports.size() <comma/> i++
                <do>
                    var report = reports.get(i);
                    var reportingSystem = report.getProperty("reportingSystem");
                    <if>reportingSystem.equals(<reportingSystem/>)
                        <then>
                            var newLine = param(<paramName/>).createChild("EnterpriseReportMapping:report", report.getProperty("name"));
                            newLine.addToParent();
                            newLine.param("reportingSystem") = reportingSystem;
                            newLine.param("calendarReportId") = report.getProperty("id");

                            var commonMappingNode = newLine.createChild("commonMappingNode", "Common Mapping");
                            commonMappingNode.addToParent();
                        </then>
                    </if>
                </do>
            </for>
        </macro>

        <macro name="mappingDisabledParameter">
            <parameter name="mappingDisabled" description="Disable Mapping" type="boolean" defaultValue="false"/>
        </macro>

        <macro name="setGenerics" arguments="genericNumber">
        var genericName=new("axiomsl.server.object_framework.util.SystemDefaults", editor.getAxiomObjectManager(), editor.getAxiomEnvironment()).getString("genericReportingSystemName"+<genericNumber/>);
        <if>genericName != null
            <then>
            <if>genericName.trim().equals("")
                <then>
                    genericName="Generic"+<genericNumber/>;
                </then>
            </if>
                genericName+=" Reports";
                param("generic"+<genericNumber/>+"Reports").getAllNodes().get(0).getAllNodes().get(0).setName(genericName);
                param("generic"+<genericNumber/>+"Reports").getAllNodes().get(0).getAllNodes().get(0).setDescription(genericName);
            </then>
        </if>
        </macro>
    </macros>
</data_set_category>